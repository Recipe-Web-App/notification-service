# Claude Code Development Guidelines

This document contains critical development rules and patterns for the notification-service.

## Critical Rules

### 1. NO FUNCTION-LEVEL IMPORTS
**NEVER** use function-level imports. ALL imports MUST be at the top of the file.

**Wrong:**
```python
def my_function():
    from some_module import SomeClass  # NEVER DO THIS
```

**Correct:**
```python
from some_module import SomeClass

def my_function():
    # Use SomeClass here
```

### 2. NO LINTER STUBS OR IGNORE COMMENTS
**NEVER** use linter ignore comments like:
- `# noqa:`
- `# type: ignore`
- `# pylint: disable`

If linter errors occur, fix the actual issue or add the rule to `pyproject.toml` ignore list.

### 3. ONE CLASS PER FILE
Each class must be in its own file. Do not put multiple classes in one file.

**Wrong:**
```python
# models.py
class User:
    pass

class Notification:
    pass
```

**Correct:**
```python
# user.py
class User:
    pass

# notification.py
class Notification:
    pass
```

### 4. NO MIGRATIONS
All models are unmanaged (`managed = False`). We do NOT own the database schema.

```python
class Meta:
    db_table = "table_name"
    managed = False  # Schema is managed externally
```

## Code Organization

### Models
- One class per file in `core/models/`
- All models are unmanaged
- Export from `core/models/__init__.py`

### Services
- Business logic in `core/services/`
- Each service in its own file
- Export from `core/services/__init__.py`

### Background Jobs
- Queue jobs in `core/jobs/`
- Use Django-RQ for async processing
- Jobs should be idempotent

### Signals
- Django signals in `core/signals/`
- Import in `CoreConfig.ready()` to avoid circular imports
- Signal handlers should not break the main transaction

### Schemas
- Pydantic schemas in `core/schemas/`
- One class per file
- Organize in subdirectories by feature

## Environment Configuration

Only TWO environment variables for email:
- `EMAIL_HOST_USER`
- `EMAIL_HOST_PASSWORD`

Everything else is code configuration (hardcoded SMTP settings).

## Testing

- Unit tests in `tests/unit/`
- Component tests in `tests/component/`
- Use pytest fixtures for common setup
- Mock external services (SMTP, Redis, etc.)

## Linting

Run before committing:
```bash
poetry run ruff check core/
poetry run mypy core/
```

Fix issues by:
1. Correcting the code
2. Adding rules to `pyproject.toml` ignore list (NOT inline comments)
